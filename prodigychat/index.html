<!DOCTYPE html>
<html>
<body>

<h2 id="bla1">ProdigyGame Chat Room Test</h2>
<p id="bla2">note that this doesnt work yet! at all! this is just for future testing of the system</p>
<form id="login">
  <label for="fname">Username:</label><br>
  <input type="text" id="username" name="username" value=""><br>
  <label for="lname">Password:</label><br>
  <input type="text" id="password" name="password" value=""><br><br>
<input type="button" id="clickem" onclick="loadAccount()" value="Login">
</form> 

<p id="login_failed"></p>
<script>
function loadAccount() {
document.getElementById('clickem').remove()
document.getElementById('bla1').remove()
document.getElementById('bla2').remove()
document.getElementById("login_failed").innerHTML = "Logging in...";
var login_success = false;
username = document.getElementById("username").value;
password = document.getElementById("password").value;
  var xhttp = new XMLHttpRequest();
  xhttp.open("GET", "https://api.prodigygame.com/game-api/status", false);
  xhttp.send();
  ServerData = JSON.parse(xhttp.responseText);
document.getElementById("login_failed").innerHTML = "Loaded server status!";
xhttp.open("GET", "https://cdn.prodigygame.com/game/data/dev/data.json", false);
  xhttp.send();
  GameData = JSON.parse(xhttp.responseText);
document.getElementById("login_failed").innerHTML = "Loaded game data!";

xhttp.open("POST", "https://api.prodigygame.com/game-auth-api/v1/login", false);
 xhttp.setRequestHeader("Content-type", "application/json"); xhttp.send(JSON.stringify({"username":username,"password":password,"clientVersion":ServerData.data.gameClientVersion}));
 User = JSON.parse(xhttp.responseText);
if (User.statusCode == 401)
{
login_success=false
}
else
{
login_success=true
}
if(login_success == false)
{
    document.getElementById("login_failed").innerHTML = "Login Failed.";
}
else
{
document.getElementById("login_failed").innerHTML = "Loaded account!";
xhttp.open("GET", "https://api.prodigygame.com/game-api/v2/characters/"+User.userID, false);
  xhttp.send();
  Appearance = JSON.parse(xhttp.responseText);
document.getElementById("login_failed").innerHTML = "Loaded appearance!";
	var ChatSocket = new WebSocket("wss://multiplayer-6.prodigygame.com/multiplayer-api/socket.io/?userId="+localStorage.getItem(User.userID)+"&worldId=61&serverId=6&jwt="+localStorage.getItem(User.token)+"&EIO=3&transport=websocket")
LoadChat()
}
  };

// Send text to all users through the server
function sendText() {
  // Construct a msg object containing the data the server needs to process the message from the chat client.
  var msg = ["message",{"action":"wizardcord","data":{"message":document.getElementById("text").value,"date":Date.now(),"userID":53794692}}]

  // Send the msg object as a JSON-formatted string.
  exampleSocket.send(JSON.stringify(msg));
  
  // Blank the text input element, ready to receive the next line of text from the user.
  document.getElementById("text").value = "";
} 

exampleSocket.onmessage = function(event) {
var msg = JSON.parse(event.data);
}
</script>
<style>
#chatty_input {
  width: 100%;
}
	</style>
<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
</body>
</html>
